<!DOCTYPE html>
<html>
<head>
    <title>Обработка в реальном времени с помощью компьютерного зрения</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            height: 96vh;
            background-color: #f0f0f0;
        }

        #main-container {
            display: flex;
            width: 100%;
            gap: 20px;
        }

        #video-section {
            flex: 3;
            min-width: 640px;
        }

        #sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        #objects-list {
            flex: 1;
            overflow-y: auto;
        }

        #video-container {
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            height: 96vh;
        }

        #video-feed {
            width: 100%;
            height: auto;
        }

        .object-card {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            background-color: #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .object-id {
            font-weight: bold;
            color: #333;
        }

        .object-action {
            color: #666;
            margin-top: 5px;
        }

        button {
            margin-top: auto; /* Прижимает кнопку к низу */
            padding: 12px 20px;
            background-color:rgb(53, 144, 186);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        #screenshot-btn {
            background-color: #4CAF50;
            height: 70px;
        }
    </style>
</head>
<body>
    <div id="main-container">
        <canvas id="screenshot-canvas" style="display:none;"></canvas>
        <div id="video-section">
            <div id="video-container">
                <img id="video-feed" src="{{ url_for('video_feed') }}" alt="Video Stream">
            </div>
        </div>
        
        <div id="sidebar">
            <h2>Обнаруженные объекты</h2>
            <div id="objects-list"></div>
            <button id="action-btn">Определять действия</button>
            <button id="face-btn">Определять эмоции</button>
            <button id="screenshot-btn">Сделать скриншот</button>
        </div>
    </div>

    <script>
        const screenshotBtn = document.getElementById('screenshot-btn');
        const objectsList = document.getElementById('objects-list');
        const videoFeed = document.getElementById('video-feed');
        const canvas = document.getElementById('screenshot-canvas');
        const ctx = canvas.getContext('2d');
        
        // Функция для создания элемента объекта
        function createObjectElement(obj) {
            const div = document.createElement('div');
            div.className = 'object-card';
            div.innerHTML = `
                <div class="object-id">ID: ${obj.id}</div>
                <div class="object-action">Действие: ${obj.action} (${(obj.confidence * 100).toFixed(1)}%)</div>
            `;
            return div;
        }

        // Обновление списка объектов
        function updateObjects(data) {
            objectsList.innerHTML = '';
            data.forEach(obj => {
                objectsList.appendChild(createObjectElement(obj));
            });
        }

        // Запрос данных об объектах
        function fetchObjects() {
            fetch('/objects_data')
                .then(response => response.json())
                .then(updateObjects)
                .catch(console.error);
        }

        // Скриншот
        screenshotBtn.addEventListener('click', () => {
        try {
            // Устанавливаем размеры canvas
            canvas.width = videoFeed.videoWidth;
            canvas.height = videoFeed.videoHeight;
            
            // Рисуем текущий кадр
            ctx.drawImage(videoFeed, 0, 0, canvas.width, canvas.height);
            
            // Создаем Data URL
            const dataUrl = canvas.toDataURL('image/jpeg', 0.9);
            
            // Создаем временную ссылку
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = `screenshot_${Date.now()}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } catch (error) {
            console.error('Ошибка при создании скриншота:', error);
            alert('Не удалось создать скриншот');
        }
    });

        // Обновление данных каждые 500 мс
        setInterval(fetchObjects, 500);
    </script>
</body>
</html>